<!DOCTYPE html>
<html>
<head>
    <title>Test Cloudflare Worker Endpoint</title>
</head>
<body>
    <h1>Cloudflare Worker API Test</h1>
    <button id="testHealth">Test Health Check (GET /)</button>
    <button id="testStats">Test Stats (GET /api/stats)</button>
    <button id="testSendPush">Test Send Push (POST /api/send-push)</button>

    <pre id="output"></pre>

    <script>
        const workerUrl = 'https://masjid-push-notifications.rodeomasjid.workers.dev';
        const apiKey = 'masjid_push_2025_secure_xyz789'; // Default API key from your setup
        const output = document.getElementById('output');

        function log(message) {
            output.textContent += message + '\n';
        }

        document.getElementById('testHealth').onclick = async () => {
            log('\n=== Testing Health Check ===');
            try {
                const response = await fetch(workerUrl + '/');
                log(`Status: ${response.status} ${response.statusText}`);
                log(`Content-Type: ${response.headers.get('content-type')}`);
                const text = await response.text();
                log(`Response: ${text}`);
            } catch (error) {
                log(`Error: ${error.message}`);
            }
        };

        document.getElementById('testStats').onclick = async () => {
            log('\n=== Testing Stats Endpoint ===');
            try {
                const response = await fetch(workerUrl + '/api/stats', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                log(`Status: ${response.status} ${response.statusText}`);
                log(`Content-Type: ${response.headers.get('content-type')}`);
                const text = await response.text();
                log(`Response: ${text}`);
            } catch (error) {
                log(`Error: ${error.message}`);
            }
        };

        document.getElementById('testSendPush').onclick = async () => {
            log('\n=== Testing Send Push Endpoint ===');
            try {
                const response = await fetch(workerUrl + '/api/send-push', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        title: 'Test Notification',
                        message: 'Testing from debug page',
                        priority: 'medium'
                    })
                });

                log(`Status: ${response.status} ${response.statusText}`);
                log(`Content-Type: ${response.headers.get('content-type')}`);

                const text = await response.text();
                log(`Response: ${text}`);

                // Try to parse as JSON
                try {
                    const json = JSON.parse(text);
                    log(`Parsed JSON: ${JSON.stringify(json, null, 2)}`);
                } catch (e) {
                    log(`Not valid JSON: ${e.message}`);
                }

            } catch (error) {
                log(`Error: ${error.message}`);
            }
        };
    </script>
</body>
</html>