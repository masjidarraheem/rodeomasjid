// Masjid Ar-Raheem - Bundled & Minified JavaScript
// =================================================
// This file combines all necessary JavaScript modules

// 1. Main App Functionality
document.addEventListener('DOMContentLoaded',function(){const navToggle=document.querySelector('.nav-toggle'),navMenu=document.querySelector('.nav-menu'),navLinks=document.querySelectorAll('.nav-link');if(navToggle){navToggle.addEventListener('click',function(){navMenu.classList.toggle('active');navToggle.classList.toggle('active')});navLinks.forEach(link=>{link.addEventListener('click',function(){navMenu.classList.remove('active');navToggle.classList.remove('active')})})}const navbar=document.querySelector('.navbar');let lastScroll=0;window.addEventListener('scroll',function(){const currentScroll=window.pageYOffset;if(currentScroll>50){navbar.classList.add('scrolled')}else{navbar.classList.remove('scrolled')}lastScroll=currentScroll});document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener('click',function(e){e.preventDefault();const targetId=this.getAttribute('href'),target=document.querySelector(targetId);document.querySelectorAll('.nav-link').forEach(link=>{link.classList.remove('active');link.classList.remove('clicked')});if(this.classList.contains('nav-link')){this.classList.add('active');this.classList.add('clicked');window.lastClickedNav=targetId;setTimeout(()=>{this.classList.remove('clicked');window.lastClickedNav=null},1500)}if(target){let offsetTop;if(targetId==='#home'){offsetTop=0}else if(targetId==='#prayer-times'){offsetTop=target.offsetTop-80}else if(targetId==='#programs'){const rect=target.getBoundingClientRect(),scrollTop=window.pageYOffset||document.documentElement.scrollTop;offsetTop=rect.top+scrollTop-100}else{offsetTop=target.offsetTop-80}window.scrollTo({top:offsetTop,behavior:'smooth'})}})});const backToTop=document.querySelector('.back-to-top');if(backToTop){window.addEventListener('scroll',function(){if(window.pageYOffset>300){backToTop.classList.add('visible')}else{backToTop.classList.remove('visible')}});backToTop.addEventListener('click',function(){window.scrollTo({top:0,behavior:'smooth'})})}const observerOptions={threshold:0.1,rootMargin:'0px 0px -50px 0px'},observer=new IntersectionObserver(function(entries){entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('visible');if(entry.target.classList.contains('info-card')){const cards=document.querySelectorAll('.info-card');cards.forEach((card,index)=>{setTimeout(()=>{card.classList.add('animate-fade-in')},index*100)})}if(entry.target.classList.contains('timeline-item')){const items=document.querySelectorAll('.timeline-item');items.forEach((item,index)=>{setTimeout(()=>{item.classList.add('animate-fade-in')},index*150)})}}})},observerOptions);const elementsToObserve=document.querySelectorAll('.info-card, .timeline-item, .donation-card, .about-grid, .contact-grid');elementsToObserve.forEach(el=>{observer.observe(el)});const animateElements=document.querySelectorAll('.section-title, .section-subtitle');animateElements.forEach(el=>{el.classList.add('animate-fade-in')});function highlightNavigation(){if(window.lastClickedNav){return}const scrollY=window.pageYOffset;document.querySelectorAll('.nav-link').forEach(link=>{if(!link.classList.contains('clicked')){link.classList.remove('active')}});let activeSection=null;if(scrollY<200){activeSection='home'}else{const sections=['contact','donate','updates','about','programs','prayer-times','home'];for(const sectionId of sections){const element=document.getElementById(sectionId);if(element){const rect=element.getBoundingClientRect(),top=rect.top;if(top<=150&&top>-rect.height+150){activeSection=sectionId;break}}}}if(activeSection){const activeLink=document.querySelector(`.nav-link[href="#${activeSection}"]`);if(activeLink&&!activeLink.classList.contains('clicked')){activeLink.classList.add('active')}}}let scrollTimer;window.addEventListener('scroll',()=>{clearTimeout(scrollTimer);scrollTimer=setTimeout(()=>{highlightNavigation()},50)});highlightNavigation();const emailForm=document.getElementById('mc-embedded-subscribe-form');if(emailForm){emailForm.addEventListener('submit',function(e){const emailInput=document.getElementById('mce-EMAIL'),emailValue=emailInput.value.trim();if(!emailValue||!validateEmail(emailValue)){e.preventDefault();emailInput.classList.add('error');emailInput.focus();setTimeout(()=>{emailInput.classList.remove('error')},3000)}})}function validateEmail(email){const re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return re.test(email)}const lazyImages=document.querySelectorAll('img[data-src]');if('IntersectionObserver' in window){const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;img.classList.add('loaded');imageObserver.unobserve(img)}})});lazyImages.forEach(img=>{imageObserver.observe(img)})}else{lazyImages.forEach(img=>{img.src=img.dataset.src})}const style=document.createElement('style');style.textContent=`.form-control.error{border-color:#f44336!important;animation:shake 0.5s}@keyframes shake{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-5px)}20%,40%,60%,80%{transform:translateX(5px)}}.nav-link.active{background:linear-gradient(135deg,rgba(0,105,92,0.1) 0%,rgba(77,182,172,0.1) 100%);color:var(--primary-dark)}img.loaded{animation:fadeIn 0.5s ease-out}.visible{opacity:1!important;transform:translateY(0)!important}`;document.head.appendChild(style);let touchStartX=0,touchEndX=0;document.addEventListener('touchstart',function(e){touchStartX=e.changedTouches[0].screenX},false);document.addEventListener('touchend',function(e){touchEndX=e.changedTouches[0].screenX;handleSwipe()},false);function handleSwipe(){if(touchEndX<touchStartX-50){navMenu.classList.remove('active');navToggle.classList.remove('active')}if(touchEndX>touchStartX+50){if(touchStartX<50){navMenu.classList.add('active');navToggle.classList.add('active')}}}let scrollTimeout;function debounceScroll(func,wait=10){return function(){clearTimeout(scrollTimeout);scrollTimeout=setTimeout(func,wait)}}window.addEventListener('scroll',debounceScroll(highlightNavigation,10));const criticalImages=['/img/newbannerlogo2.png','/img/birdsview.jpg'];criticalImages.forEach(src=>{const img=new Image();img.src=src});if(!('IntersectionObserver' in window)){document.querySelectorAll('.info-card, .timeline-item, .donation-card').forEach(el=>{el.style.opacity='1';el.style.transform='translateY(0)'})}navToggle.addEventListener('keypress',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();navMenu.classList.toggle('active');navToggle.classList.toggle('active')}});function trapFocus(element){const focusableElements=element.querySelectorAll('a, button, input, select, textarea'),firstFocusable=focusableElements[0],lastFocusable=focusableElements[focusableElements.length-1];element.addEventListener('keydown',function(e){if(e.key==='Tab'){if(e.shiftKey){if(document.activeElement===firstFocusable){e.preventDefault();lastFocusable.focus()}}else{if(document.activeElement===lastFocusable){e.preventDefault();firstFocusable.focus()}}}if(e.key==='Escape'){navMenu.classList.remove('active');navToggle.classList.remove('active');navToggle.focus()}})}const menuObserver=new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(navMenu.classList.contains('active')){trapFocus(navMenu)}})});menuObserver.observe(navMenu,{attributes:true,attributeFilter:['class']})});

// 2. Announcement Modal Functions
function closeAnnouncementModal(){const modal=document.getElementById('announcementModal');if(modal){modal.classList.add('modal-minimizing');setTimeout(()=>{modal.style.display='none';modal.classList.remove('modal-minimizing')},500)}}function minimizeAnnouncement(){const modal=document.getElementById('announcementModal'),floatingBtn=document.getElementById('floatingButton');if(modal&&floatingBtn){modal.classList.add('modal-minimizing');setTimeout(()=>{modal.style.display='none';modal.classList.remove('modal-minimizing');floatingBtn.style.display='block';floatingBtn.classList.add('button-appearing')},500)}}function expandAnnouncement(){const modal=document.getElementById('announcementModal'),floatingBtn=document.getElementById('floatingButton');if(modal&&floatingBtn){floatingBtn.style.display='none';modal.style.display='block';modal.classList.add('modal-expanding');setTimeout(()=>{modal.classList.remove('modal-expanding')},500)}}(function(){const floatingBtn=document.getElementById('floatingButton');if(floatingBtn){let isDragging=false,currentX,currentY,initialX,initialY,xOffset=0,yOffset=0;function dragStart(e){if(e.type==="touchstart"){initialX=e.touches[0].clientX-xOffset;initialY=e.touches[0].clientY-yOffset}else{initialX=e.clientX-xOffset;initialY=e.clientY-yOffset}if(e.target===floatingBtn||e.target.parentElement===floatingBtn){isDragging=true}}function dragEnd(e){initialX=currentX;initialY=currentY;isDragging=false}function drag(e){if(isDragging){e.preventDefault();if(e.type==="touchmove"){currentX=e.touches[0].clientX-initialX;currentY=e.touches[0].clientY-initialY}else{currentX=e.clientX-initialX;currentY=e.clientY-initialY}xOffset=currentX;yOffset=currentY;const maxX=window.innerWidth-floatingBtn.offsetWidth-20,maxY=window.innerHeight-floatingBtn.offsetHeight-20;currentX=Math.min(Math.max(currentX,-20),maxX);currentY=Math.min(Math.max(currentY,0),maxY);floatingBtn.style.transform=`translate(${currentX}px, ${currentY}px)`;floatingBtn.style.right='auto';floatingBtn.style.top='80px'}}floatingBtn.addEventListener('touchstart',dragStart,{passive:false});floatingBtn.addEventListener('touchend',dragEnd,{passive:false});floatingBtn.addEventListener('touchmove',drag,{passive:false});floatingBtn.addEventListener('mousedown',dragStart);document.addEventListener('mouseup',dragEnd);document.addEventListener('mousemove',drag)}})();

// 3. Service Worker Registration
if('serviceWorker' in navigator){window.addEventListener('load',function(){/*navigator.serviceWorker.register('/sw.js')*/})}

console.log('Masjid Ar-Raheem website loaded successfully');